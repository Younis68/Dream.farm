<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0f2e20">
    
    <meta property="og:type" content="website">
    <meta property="og:title" content="Dream Farm">
    <meta property="og:description" content="Best Farms Rentals in Iraq & Kurdistan">
    <meta property="og:image" content="dream.jpg">
    
    <title>Dream Farm | Rentals</title>
    <link rel="icon" href="https://img.icons8.com/emoji/48/crown-emoji.png" type="image/png">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/material_green.css">

    <style>
        /* CSS Variables */
        :root { 
            --primary-gold: #D4AF37; 
            --primary-dark: #0f2e20; 
            --bg-body: #f4f7f6; 
            --bg-card: #ffffff;
            --text-main: #1a1a1a;
            --text-sec: #555555;
            --border-color: #eeeeee;
            --input-bg: #ffffff;
            --badge-bg: #f4f7f6;
            --shadow-color: rgba(0,0,0,0.08);
            --radius-lg: 24px; 
            --font-ar: 'Tajawal', sans-serif;
            --font-en: 'Poppins', sans-serif;
        }

        [data-theme="dark"] {
            --bg-body: #121212;
            --bg-card: #1e1e1e;
            --text-main: #e0e0e0;
            --text-sec: #aaaaaa;
            --border-color: #333333;
            --input-bg: #2c2c2c;
            --badge-bg: #2c2c2c;
            --shadow-color: rgba(0,0,0,0.5);
        }

        /* Basic Setup */
        * { box-sizing: border-box; outline: none; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        
        /* Dynamic Font based on Language */
        body { font-family: var(--font-ar); background-color: var(--bg-body); color: var(--text-main); overflow-x: hidden; display: flex; flex-direction: column; min-height: 100vh; transition: 0.3s; }
        html[lang="en"] body { font-family: var(--font-en); }

        /* Urgency Animation */
        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(211, 47, 47, 0.7); } 70% { box-shadow: 0 0 0 6px rgba(211, 47, 47, 0); } 100% { box-shadow: 0 0 0 0 rgba(211, 47, 47, 0); } }
        .urgency-badge { display: inline-flex; align-items: center; gap: 6px; background: rgba(255, 235, 238, 0.9); color: #c62828; padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 700; margin-top: 8px; margin-bottom: 5px; width: fit-content; animation: pulse-red 2s infinite; border: 1px solid rgba(211, 47, 47, 0.2); }
        [data-theme="dark"] .urgency-badge { background: rgba(60, 20, 20, 0.8); color: #ff8a80; border-color: rgba(255, 138, 128, 0.2); }

        /* Amenities */
        .amenities-list { margin: 15px 0 20px; display: flex; flex-wrap: wrap; gap: 10px; }
        .amenity-chip { background: var(--bg-body); padding: 10px 14px; border-radius: 16px; border: 1px solid var(--border-color); display: flex; align-items: center; gap: 10px; font-size: 0.85rem; font-weight: 500; color: var(--text-main); transition: all 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .amenity-chip:hover { transform: translateY(-3px); }

        /* Header & Navigation */
        header { background-image: linear-gradient(rgba(15, 46, 32, 0.6), rgba(26, 60, 48, 0.8)), url('dream.jpg'); background-size: cover; background-position: center; background-color: var(--primary-dark); min-height: 380px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; border-bottom-left-radius: 40px; border-bottom-right-radius: 40px; padding: 20px 20px 80px 20px; position: relative; }
        [data-theme="dark"] header { background-image: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.9)), url('dream.jpg'); }

        header h1 { font-size: 2.8rem; color: white; margin: 10px 0; font-weight: 800; text-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .brand-badge { background: rgba(255,255,255,0.15); padding: 8px 20px; border-radius: 50px; border: 1px solid rgba(255,255,255,0.3); color: var(--primary-gold); font-size: 0.9rem; font-weight: 700; backdrop-filter: blur(5px); }
        
        .header-btns { position: absolute; top: 25px; right: 25px; display: flex; gap: 10px; z-index: 100; }
        html[dir="ltr"] .header-btns { right: auto; left: 25px; }

        .icon-btn { background: rgba(255, 255, 255, 0.15); color: white; width: 45px; height: 45px; border-radius: 50%; font-size: 1.2rem; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.3s; border: 1px solid rgba(255,255,255,0.2); position: relative; }
        .icon-btn:hover { background: rgba(255, 255, 255, 0.3); }

        /* Language Dropdown */
        .lang-dropdown { position: absolute; top: 55px; right: 0; background: var(--bg-card); border-radius: 16px; padding: 10px; width: 140px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); display: none; flex-direction: column; gap: 5px; border: 1px solid var(--border-color); z-index: 200; overflow: hidden; }
        html[dir="ltr"] .lang-dropdown { right: auto; left: 0; }
        .lang-dropdown.show { display: flex; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity:0; transform:translateY(-10px); } to { opacity:1; transform:translateY(0); } }
        .lang-opt { padding: 10px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; gap: 10px; color: var(--text-main); font-size: 0.9rem; transition: 0.2s; }
        .lang-opt:hover { background: var(--badge-bg); }
        .lang-opt.active { background: var(--primary-gold); color: white; }

        /* Search & Filters */
        .search-container { margin-top: -60px; padding: 0 20px; position: relative; z-index: 50; display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .search-box-wrapper { background: var(--bg-card); width: 100%; max-width: 700px; padding: 5px; border-radius: 50px; display: flex; align-items: center; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 1px solid var(--border-color); }
        
        .search-input-group { flex: 1; display: flex; align-items: center; padding-right: 15px; border-left: 1px solid var(--border-color); }
        html[dir="ltr"] .search-input-group { padding-right: 0; padding-left: 15px; border-left: none; border-right: 1px solid var(--border-color); }
        
        .search-input-group input { width: 100%; border: none; font-size: 1rem; padding: 12px 0; font-family: inherit; color: var(--text-main); background: transparent; }
        .search-input-group i { color: var(--primary-gold); margin-left: 10px; font-size: 1.1rem; }
        html[dir="ltr"] .search-input-group i { margin-left: 0; margin-right: 10px; }

        .date-input-group { width: 140px; display: flex; align-items: center; padding: 0 15px; cursor: pointer; position: relative; }
        .date-input-group input { width: 100%; border: none; font-size: 0.9rem; padding: 12px 0; font-family: inherit; color: var(--text-sec); cursor: pointer; background: transparent; text-align: center; }
        .date-input-group i { color: var(--primary-dark); margin-left: 8px; font-size: 1rem; }
        html[dir="ltr"] .date-input-group i { margin-left: 0; margin-right: 8px; }
        .clear-date { position: absolute; left: 5px; color: #999; font-size: 0.8rem; cursor: pointer; display: none; }
        html[dir="ltr"] .clear-date { left: auto; right: 5px; }

        .filter-scroll { width: 100%; max-width: 800px; overflow-x: auto; padding-bottom: 5px; display: flex; gap: 10px; justify-content: flex-start; scrollbar-width: none; }
        .filter-btn { white-space: nowrap; padding: 10px 20px; border-radius: 30px; border: 1px solid transparent; background: rgba(255,255,255,0.9); color: var(--primary-dark); font-family: inherit; font-weight: 600; cursor: pointer; transition: 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.05); font-size: 0.9rem; display: flex; align-items: center; gap: 8px; }
        [data-theme="dark"] .filter-btn { background: #2c2c2c; color: #e0e0e0; border: 1px solid #444; }
        .filter-btn.active { background: var(--primary-gold) !important; color: white !important; border-color: var(--primary-gold) !important; }

        /* Cards & Container */
        .container { display: grid; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); gap: 30px; max-width: 1200px; margin: 30px auto; padding: 0 20px; flex: 1; width: 100%; }
        
        .farm-card { background: var(--bg-card); border-radius: var(--radius-lg); overflow: hidden; box-shadow: 0 15px 40px var(--shadow-color); position: relative; display: flex; flex-direction: column; transition: transform 0.3s ease; border: 1px solid var(--border-color); opacity: 0; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .farm-card.is-visible { opacity: 1; animation: fadeInUp 0.5s ease forwards; }
        .farm-card:hover { transform: translateY(-5px); }
        
        .swiper { width: 100%; height: 260px; background: #eee; }
        .swiper-slide img { width: 100%; height: 100%; object-fit: cover; }
        
        .img-actions { position: absolute; top: 15px; left: 15px; z-index: 20; display: flex; flex-direction: column; gap: 10px; }
        html[dir="ltr"] .img-actions { left: auto; right: 15px; }

        .action-icon { width: 38px; height: 38px; background: rgba(255,255,255,0.9); backdrop-filter: blur(4px); color: var(--primary-dark); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: 0.2s; font-size: 1rem; }
        .action-icon:hover { transform: scale(1.1); }
        .action-icon.is-fav { color: #e91e63; background: white; }
        
        .expand-btn { position: absolute; bottom: 15px; right: 15px; width: 38px; height: 38px; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 1px solid rgba(255,255,255,0.3); z-index: 20; }
        html[dir="ltr"] .expand-btn { right: auto; left: 15px; }

        .card-content { padding: 25px; flex-grow: 1; display: flex; flex-direction: column; }
        .card-title-row { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 5px; }
        .card-title-row h3 { font-size: 1.2rem; color: var(--text-main); display: flex; align-items: center; gap: 6px; }
        .verified-badge { color: #1da1f2; font-size: 1rem; }

        .location-text { font-size: 0.9rem; color: var(--text-sec); margin-bottom: 10px; display: flex; align-items: center; gap: 5px; margin-top: 10px; }
        
        .price-wrapper { margin-top: auto; padding-top: 15px; border-top: 1px dashed var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .price-val { font-size: 1.3rem; font-weight: 800; color: var(--primary-gold); }
        .book-btn { background: var(--primary-dark); color: white; border: none; padding: 12px 28px; border-radius: 14px; cursor: pointer; font-weight: 700; transition: 0.3s; box-shadow: 0 4px 15px rgba(15, 46, 32, 0.2); font-family: inherit; }
        [data-theme="dark"] .book-btn { background: var(--primary-gold); color: black; }

        /* Modals & Overlays */
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(8px); z-index: 2000; justify-content: center; align-items: center; padding: 20px; }
        .modal-box { background: var(--bg-card); width: 100%; max-width: 450px; border-radius: 24px; padding: 30px; position: relative; max-height: 90vh; overflow-y: auto; box-shadow: 0 25px 50px rgba(0,0,0,0.3); animation: slideUp 0.3s ease; color: var(--text-main); }
        .modal-active { display: flex; }
        .close-modal { position: absolute; left: 20px; top: 20px; font-size: 1.2rem; background: var(--badge-bg); width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--text-sec); cursor: pointer; }
        html[dir="ltr"] .close-modal { left: auto; right: 20px; }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-main); font-size: 0.9rem; }
        .form-group input, .form-group select { width: 100%; padding: 12px 15px; border: 2px solid var(--border-color); border-radius: 12px; font-family: inherit; font-size: 1rem; transition: 0.2s; background: var(--input-bg); color: var(--text-main); }
        .submit-wa { width: 100%; padding: 16px; border: none; border-radius: 12px; background: linear-gradient(135deg, #25D366, #128C7E); color: white; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 1rem; margin-top: 10px; font-family: inherit; }
        
        /* Lightbox */
        .lightbox-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 12000; display: none; justify-content: center; align-items: center; flex-direction: column; opacity: 0; transition: opacity 0.3s ease; }
        .lightbox-active { display: flex; opacity: 1; pointer-events: all; }
        .lightbox-img-container { position: relative; max-width: 90%; max-height: 80vh; }
        .lightbox-img { max-width: 100%; max-height: 80vh; border-radius: 8px; object-fit: contain; }
        .lb-close { position: absolute; top: 20px; right: 20px; color: white; font-size: 2.5rem; cursor: pointer; z-index: 10001; }
        .lb-nav { position: absolute; top: 50%; transform: translateY(-50%); color: white; font-size: 2rem; cursor: pointer; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 50%; z-index: 10002; }
        .lb-prev { right: 20px; } .lb-next { left: 20px; }
        html[dir="ltr"] .lb-prev { right: auto; left: 20px; } 
        html[dir="ltr"] .lb-next { left: auto; right: 20px; }

        /* Others */
        #loader { position: fixed; inset: 0; background: var(--primary-dark); z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column; transition: opacity 0.5s ease; pointer-events: none; }
        .loader-icon { font-size: 3rem; color: var(--primary-gold); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        
        .social-dock { position: fixed; bottom: 30px; left: 25px; display: flex; flex-direction: column-reverse; gap: 15px; z-index: 90; }
        html[dir="ltr"] .social-dock { left: auto; right: 25px; }
        .social-bubble { width: 48px; height: 48px; border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; font-size: 1.3rem; box-shadow: 0 5px 20px rgba(0,0,0,0.25); text-decoration: none; transition: 0.3s transform; }
        .social-bubble:hover { transform: scale(1.1); }
        .wa { background: #25D366; } .tk { background: #000; } [data-theme="dark"] .tk { background: #fff; color: black; } .fb { background: #1877F2; } .in { background: radial-gradient(circle at 30% 107%, #fdf497 0%, #fd5949 45%, #d6249f 60%, #285AEB 90%); }
        
        #scrollTopBtn { position: fixed; bottom: 95px; left: 25px; width: 48px; height: 48px; background: var(--primary-dark); color: var(--primary-gold); border: 2px solid var(--primary-gold); border-radius: 50%; display: none; align-items: center; justify-content: center; cursor: pointer; z-index: 89; }
        html[dir="ltr"] #scrollTopBtn { left: auto; right: 25px; }

        footer { background-color: var(--primary-dark); color: white; padding: 50px 20px 30px; text-align: center; margin-top: 50px; border-top-left-radius: 40px; border-top-right-radius: 40px; }
        [data-theme="dark"] footer { background-color: #000; }
        .footer-links { display: flex; justify-content: center; gap: 20px; margin: 20px 0; font-size: 0.9rem; }
        .footer-links a { color: rgba(255,255,255,0.8); text-decoration: none; transition: 0.2s; }
        .footer-links a:hover { color: white; }

        @media (max-width: 600px) { header { min-height: 320px; padding-bottom: 60px; } header h1 { font-size: 2.2rem; } .swiper { height: 220px; } .search-container { margin-top: -50px; } }
    </style>
</head>
<body>

    <div id="loader"><i class="fas fa-gem loader-icon"></i></div>

    <div id="welcome-modal" class="modal-overlay" style="z-index:9500; display:flex; opacity:0; pointer-events:none; transition:0.5s;">
        <div class="modal-box" style="text-align:center; border:2px solid var(--primary-gold);">
            <i class="fas fa-crown" style="font-size:3.5rem; color:var(--primary-gold); margin-bottom:15px;"></i>
            <h2 id="wm-title" style="margin-bottom:10px;">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Dream Farm</h2>
            <p id="wm-subtitle" style="color:var(--text-sec);">Ø§Ù„ÙˆØ¬Ù‡Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù„Ù„Ù…Ø²Ø§Ø±Ø¹ Ø§Ù„Ø±Ø§Ù‚ÙŠØ©</p>
            <ul style="text-align:start; list-style:none; padding:20px; background:var(--badge-bg); border-radius:16px; margin:20px 0;">
                <li style="margin-bottom:10px; display:flex; align-items:center; gap:10px; color:#d32f2f;">
                    <i class="fas fa-exclamation-triangle"></i> 
                    <span id="wm-note1"><b>ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ø§Ù…:</b> Ø§Ù„Ø­Ø¬Ø² Ù„Ø§ ÙŠØªÙ… Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ Ø¯ÙØ¹ Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ†.</span>
                </li>
                <li style="display:flex; align-items:center; gap:10px;">
                    <i class="fas fa-credit-card" style="color:var(--primary-gold)"></i> 
                    <span id="wm-note2"><b>Ø§Ù„Ø¯ÙØ¹:</b> Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ† Ø¹Ø¨Ø± Qi Card Ø­ØµØ±Ø§Ù‹.</span>
                </li>
            </ul>
            <button class="book-btn" style="width:100%" onclick="acceptTerms()" id="wm-btn">Ù…ÙˆØ§ÙÙ‚ØŒ Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØµÙØ­</button>
        </div>
    </div>

    <header>
        <span class="brand-badge" id="lbl-premium">Premium Rentals</span>
        <div class="header-btns">
            <div style="position:relative">
                <div class="icon-btn" onclick="toggleLangMenu()"><i class="fas fa-globe"></i></div>
                <div id="lang-menu" class="lang-dropdown">
                    <div class="lang-opt" onclick="setLanguage('ar')"><img src="https://img.icons8.com/color/48/iraq.png" width="20"> Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</div>
                    <div class="lang-opt" onclick="setLanguage('ku')"><img src="https://img.icons8.com/color/48/kurdistan.png" width="20"> Ú©ÙˆØ±Ø¯ÛŒ</div>
                    <div class="lang-opt" onclick="setLanguage('en')"><img src="https://img.icons8.com/color/48/usa.png" width="20"> English</div>
                </div>
            </div>
            <div class="icon-btn" onclick="toggleTheme()"><i id="theme-icon" class="fas fa-moon"></i></div>
            <div class="icon-btn settings-btn" onclick="openSettingsModal()"><i class="fas fa-cog"></i></div>
        </div>
        <h1 id="main-title">Dream Farm</h1>
        <p id="main-subtitle" style="color:rgba(255,255,255,0.8);">ØªØ¬Ø±Ø¨Ø© Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠØ© Ù„Ø£Ø¬Ù…Ù„ Ø§Ù„Ù…Ø²Ø§Ø±Ø¹ Ø§Ù„Ø³ÙŠØ§Ø­ÙŠØ©</p>
    </header>

    <div class="search-container">
        <div class="search-box-wrapper">
            <div class="search-input-group">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø²Ø±Ø¹Ø©...">
            </div>
            <div class="date-input-group">
                <i class="far fa-calendar-alt"></i>
                <input type="text" id="searchDate" placeholder="Ø§Ù„ØªØ§Ø±ÙŠØ®" readonly>
                <i class="fas fa-times-circle clear-date" id="clearDateBtn" onclick="clearSearchDate(event)"></i>
            </div>
        </div>
        
        <div class="filter-scroll">
            <button class="filter-btn active" onclick="filterFarms('all', this)"><i class="fas fa-th"></i> <span id="btn-all">Ø§Ù„ÙƒÙ„</span></button>
            <button class="filter-btn" onclick="filterFarms('favorites', this)"><i class="fas fa-heart" style="color:#e91e63"></i> <span id="btn-fav">Ø§Ù„Ù…ÙØ¶Ù„Ø©</span></button>
            <button class="filter-btn" onclick="filterFarms('family', this)"><i class="fas fa-users"></i> <span id="btn-fam">Ø¹Ø§Ø¦Ù„Ø§Øª</span></button>
            <button class="filter-btn" onclick="filterFarms('pool', this)"><i class="fas fa-swimming-pool"></i> <span id="btn-pool">Ù…Ø³Ø¨Ø­</span></button>
            <button class="filter-btn" onclick="filterFarms('youth', this)"><i class="fas fa-user-friends"></i> <span id="btn-youth">Ø´Ø¨Ø§Ø¨</span></button>
        </div>
    </div>

    <div class="container" id="farm-list-container"></div>
    
    <div class="social-dock">
        <a href="#" class="social-bubble fb"><i class="fab fa-facebook-f"></i></a>
        <a href="#" class="social-bubble in"><i class="fab fa-instagram"></i></a>
        <a href="https://www.tiktok.com/@dream.farm68" class="social-bubble tk"><i class="fab fa-tiktok"></i></a>
    </div>
    <button id="scrollTopBtn" onclick="scrollToTop()"><i class="fas fa-arrow-up"></i></button>

    <footer>
        <span class="footer-logo">Dream Farm</span>
        <p id="ft-desc" style="font-size:0.9rem; color:rgba(255,255,255,0.7);">Ø£ÙØ¶Ù„ Ø®ÙŠØ§Ø± Ù„Ù‚Ø¶Ø§Ø¡ Ø¹Ø·Ù„Ø© Ù…Ù…ÙŠØ²Ø©</p>
        <div class="footer-links">
            <a href="#" onclick="scrollToTop()" id="ft-home">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <a href="#" onclick="filterFarms('favorites')" id="ft-fav">Ø§Ù„Ù…ÙØ¶Ù„Ø©</a>
            <a href="#" onclick="openSettingsModal()" id="ft-terms">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø­Ø¬Ø²</a>
        </div>
        <div class="copyright">&copy; 2025 Dream Farm. All rights reserved.</div>
    </footer>

    <div id="settings-modal" class="modal-overlay">
        <div class="modal-box">
            <span class="close-modal" onclick="closeSettingsModal()">&times;</span>
            <h3 id="st-title" style="text-align:center; margin-bottom:25px;">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</h3>
            <div style="background:rgba(37, 211, 102, 0.1); border:2px dashed #25D366; padding:25px; border-radius:16px; text-align:center; margin-bottom:30px;">
                <div style="width:60px; height:60px; background:#25D366; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 15px;">
                    <i class="fas fa-home" style="font-size:1.8rem; color:white;"></i>
                </div>
                <h4 id="st-add-title" style="margin-bottom:8px;">Ù‡Ù„ ØªÙ…Ù„Ùƒ Ù…Ø²Ø±Ø¹Ø©ØŸ</h4>
                <p id="st-add-desc" style="font-size:0.85rem; color:var(--text-sec); margin-bottom:15px;">Ø§Ù†Ø¶Ù… Ø¥Ù„ÙŠÙ†Ø§ ÙˆØ§Ø¹Ø±Ø¶ Ù…Ø²Ø±Ø¹ØªÙƒ Ù„Ù„Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„Ø¢Ù†</p>
                <a href="https://wa.me/9647502679528" target="_blank" style="background:#25D366; color:white; padding:10px 25px; border-radius:30px; text-decoration:none; font-weight:bold; display:inline-block;" id="st-add-btn">ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</a>
            </div>
        </div>
    </div>

    <div id="booking-modal" class="modal-overlay">
        <div class="modal-box">
            <span class="close-modal" onclick="closeModal()"><i class="fas fa-times"></i></span>
            <h3 id="bk-title" style="text-align:center; margin-bottom:5px;">Ø·Ù„Ø¨ Ø­Ø¬Ø²</h3>
            <p style="text-align:center;color:var(--text-sec);font-size:0.9rem;margin-bottom:20px;"><span id="modal-farm-name" style="color:var(--primary-gold);font-weight:bold;"></span></p>
            <form id="booking-form">
                <input type="hidden" id="farm-id-modal">
                <div class="form-group"><label id="lbl-name">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ</label><input type="text" id="name" required></div>
                <div class="form-group"><label id="lbl-date">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¬Ø²</label><input type="text" id="date" required style="cursor:pointer;"></div>
                <div id="price-calc-area" style="text-align:center; padding:15px; background:var(--badge-bg); border:1px solid var(--border-color); border-radius:12px; margin-bottom:20px; display:none;"></div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                    <div class="form-group"><label id="lbl-guests">Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ</label><input type="number" id="guests" required min="1"></div>
                    <div class="form-group"><label id="lbl-families">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹ÙˆØ§Ø¦Ù„</label><input type="number" id="families" min="1"></div>
                </div>
                <div class="form-group"><label id="lbl-type">Ù†ÙˆØ¹ Ø§Ù„ÙƒØ±ÙˆØ¨</label><select id="type" required></select></div>
                <button type="submit" id="submit-btn" class="submit-wa"><i class="fab fa-whatsapp" style="font-size:1.2rem;"></i> <span id="btn-send">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§ØªØ³Ø§Ø¨</span></button>
            </form>
        </div>
    </div>

    <div id="lightbox" class="lightbox-overlay">
        <span class="lb-close" onclick="closeLightbox()">&times;</span>
        <div class="lb-nav lb-prev" onclick="changeImage(-1)"><i class="fas fa-chevron-right"></i></div>
        <div class="lb-nav lb-next" onclick="changeImage(1)"><i class="fas fa-chevron-left"></i></div>
        <div class="lightbox-img-container"><img id="lb-image" class="lightbox-img" src="" alt="Full View"></div>
        <div style="color:#ccc; margin-top:15px; font-family:sans-serif" id="lb-counter"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/ar.js"></script>

    <script>
        // --- Translations ---
        const translations = {
            ar: {
                mainTitle: "Dream Farm",
                mainSubtitle: "ØªØ¬Ø±Ø¨Ø© Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠØ© Ù„Ø£Ø¬Ù…Ù„ Ø§Ù„Ù…Ø²Ø§Ø±Ø¹ Ø§Ù„Ø³ÙŠØ§Ø­ÙŠØ©",
                searchPlace: "Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø²Ø±Ø¹Ø©...",
                datePlace: "Ø§Ù„ØªØ§Ø±ÙŠØ®",
                btnAll: "Ø§Ù„ÙƒÙ„", btnFav: "Ø§Ù„Ù…ÙØ¶Ù„Ø©", btnFam: "Ø¹Ø§Ø¦Ù„Ø§Øª", btnPool: "Ù…Ø³Ø¨Ø­", btnYouth: "Ø´Ø¨Ø§Ø¨",
                wmTitle: "Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Dream Farm",
                wmSubtitle: "Ø§Ù„ÙˆØ¬Ù‡Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù„Ù„Ù…Ø²Ø§Ø±Ø¹ Ø§Ù„Ø±Ø§Ù‚ÙŠØ©",
                wmNote1: "<b>ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ø§Ù…:</b> Ø§Ù„Ø­Ø¬Ø² Ù„Ø§ ÙŠØªÙ… Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ Ø¯ÙØ¹ Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ†.",
                wmNote2: "<b>Ø§Ù„Ø¯ÙØ¹:</b> Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ† Ø¹Ø¨Ø± Qi Card Ø­ØµØ±Ø§Ù‹.",
                wmBtn: "Ù…ÙˆØ§ÙÙ‚ØŒ Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØµÙØ­",
                bookBtn: "Ø§Ø­Ø¬Ø² Ø§Ù„Ø¢Ù†",
                curr: "Ø¯.Ø¹",
                viewers: "Ø£Ø´Ø®Ø§Øµ ÙŠØ´Ø§Ù‡Ø¯ÙˆÙ† Ø§Ù„Ø¢Ù†",
                bkTitle: "Ø·Ù„Ø¨ Ø­Ø¬Ø²",
                lblName: "Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ", lblDate: "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¬Ø²", lblGuests: "Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ", lblFamilies: "Ø¹Ø¯Ø¯ Ø§Ù„Ø¹ÙˆØ§Ø¦Ù„", lblType: "Ù†ÙˆØ¹ Ø§Ù„ÙƒØ±ÙˆØ¨",
                btnSend: "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§ØªØ³Ø§Ø¨",
                stTitle: "Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©",
                stAddTitle: "Ù‡Ù„ ØªÙ…Ù„Ùƒ Ù…Ø²Ø±Ø¹Ø©ØŸ",
                stAddDesc: "Ø§Ù†Ø¶Ù… Ø¥Ù„ÙŠÙ†Ø§ ÙˆØ§Ø¹Ø±Ø¶ Ù…Ø²Ø±Ø¹ØªÙƒ Ù„Ù„Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„Ø¢Ù†",
                stAddBtn: "ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©",
                ftDesc: "Ø£ÙØ¶Ù„ Ø®ÙŠØ§Ø± Ù„Ù‚Ø¶Ø§Ø¡ Ø¹Ø·Ù„Ø© Ù…Ù…ÙŠØ²Ø©", ftHome: "Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", ftFav: "Ø§Ù„Ù…ÙØ¶Ù„Ø©", ftTerms: "Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø­Ø¬Ø²",
                types: { family: "Ø¹Ø§Ø¦Ù„Ø§Øª", youth: "Ø´Ø¨Ø§Ø¨", mixed: "Ù…Ø®ØªÙ„Ø·" }
            },
            ku: {
                mainTitle: "Dream Farm",
                mainSubtitle: "Ø¨Ø§Ø´ØªØ±ÛŒÙ† Ø¦Û•Ø²Ù…ÙˆÙˆÙ† Ø¨Û† Ø¨Û•Ú©Ø±ÛÚ¯Ø±ØªÙ†Ø§ Ù…Û•Ø²Ø±Û•Ø¹Ø§Ù†",
                searchPlace: "Ù„ÛÚ¯Û•Ø±ÛŒØ§Ù†...",
                datePlace: "Ù…ÛÚ˜ÙˆÙˆ",
                btnAll: "Ù‡Û•Ù…ÛŒ", btnFav: "Ø¯ÚµØ®ÙˆØ§Ø²", btnFam: "Ø®ÛØ²Ø§Ù†", btnPool: "Ù…Û•Ø³Ø¨Û•Ø­", btnYouth: "Ú¯Û•Ù†Ø¬",
                wmTitle: "Ø¨Û•Ø®ÛØ±Ø¨ÛÛŒ Ø¨Û† Dream Farm",
                wmSubtitle: "Ø¨Ø§Ø´ØªØ±ÛŒÙ† Ø´ÙˆÛÙ† Ø¨Û† Ú¯Û•Ø´Øª Ùˆ Ø³Û•ÛŒØ±Ø§Ù†Ø§Ù†",
                wmNote1: "<b>Ø¦Ú¯Û•Ù‡Ø¯Ø§Ø±ÛŒ:</b> Ø­ÛŒØ¬Ø²Ú©Ø±Ù† Ù†Ø§Ø¨ÛŒØª Ø¨ÛÛŒ Ù¾ÛØ´Û•Ú©ÛŒ (Ø¹Û•Ø±Ø¨ÙˆÙ†).",
                wmNote2: "<b>Ù¾Ø§Ø±Û•Ø¯Ø§Ù†:</b> ØªÛ•Ù†Ù‡Ø§ Ù„ Ø±ÛÚ©Ø§ Qi Card ÛŒÛ•.",
                wmBtn: "Ø¨Ø§Ø´Û•ØŒ Ø¯Û•Ø³ØªÙ¾ÛØ¨Ú©Û•",
                bookBtn: "Ù†ÙˆÚ©Û• Ø­ÛŒØ¬Ø² Ø¨Ú©Û•",
                curr: "Ø¯.Ø¹",
                viewers: "Ú©Û•Ø³ Ù†ÙˆÚ©Û• ØªÛ•Ù…Ø§Ø´Û• Ø¯Ú©Û•Ù†",
                bkTitle: "Ø¯Ø§Ø®ÙˆØ§Ø²Ø§ Ø­ÛŒØ¬Ø²Ú©Ø±Ù†Û",
                lblName: "Ù†Ø§Ú¤Û Ø³ÛŒØ§Ù†ÛŒ", lblDate: "Ø±Û†Ú˜Ø§ Ø­Ø¬Ø²Ú©Ø±Ù†Û", lblGuests: "Ú˜Ù…Ø§Ø±Ø§ Ú¯Ø´ØªÛŒ", lblFamilies: "Ú˜Ù…Ø§Ø±Ø§ Ø®ÛØ²Ø§Ù†Ø§", lblType: "Ø¬Û†Ø±Û Ú¯Ø±ÙˆØ¨ÛŒ",
                btnSend: "ÙØ±ÛÚ©Ø±Ù†Ø§ Ø¯Ø§Ø®ÙˆØ§Ø²Û (WhatsApp)",
                stTitle: "Ø±ÛÚ©Ø®Ø³ØªÙ† Ùˆ Ù‡Ø§Ø±ÛŒÚ©Ø§Ø±ÛŒ",
                stAddTitle: "ØªÛ• Ù…Û•Ø²Ø±Û•Ø¹Û• Ù‡Û•ÛŒÛ•ØŸ",
                stAddDesc: "Ù…Û•Ø²Ø±Û•Ø¹Ø§ Ø®Û† ØªÛ†Ù…Ø§Ø± Ø¨Ú©Û• Ùˆ Ø¨Ø¯Û• Ú©Ø±Û",
                stAddBtn: "Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒÛ Ø¨ Ù…Û• Ø¨Ú©Û•",
                ftDesc: "Ø¨Ø§Ø´ØªØ±ÛŒÙ† Ù‡Û•ÚµØ¨Ú˜Ø§Ø±Ø¯Ù† Ø¨Û† Ø¨ÛÙ‡Ù†Ú¤Û•Ø¯Ø§Ù†Û•Ú©Ø§ Ø®Û†Ø´", ftHome: "Ø³Û•Ø±Û•Ú©ÛŒ", ftFav: "Ø¯ÚµØ®ÙˆØ§Ø²", ftTerms: "ÛŒØ§Ø³Ø§ÛŒÛÙ† Ø­ÛŒØ¬Ø²Ú©Ø±Ù†Û",
                types: { family: "Ø®ÛØ²Ø§Ù†", youth: "Ú¯Û•Ù†Ø¬", mixed: "ØªÛÚ©Û•Úµ" }
            },
            en: {
                mainTitle: "Dream Farm",
                mainSubtitle: "Exceptional experience for luxury farm rentals",
                searchPlace: "Search for a farm...",
                datePlace: "Date",
                btnAll: "All", btnFav: "Favorites", btnFam: "Families", btnPool: "Pool", btnYouth: "Youth",
                wmTitle: "Welcome to Dream Farm",
                wmSubtitle: "Premium Farm Rentals Destination",
                wmNote1: "<b>Note:</b> Booking requires a deposit.",
                wmNote2: "<b>Payment:</b> Deposit via Qi Card only.",
                wmBtn: "Agree & Browse",
                bookBtn: "Book Now",
                curr: "IQD",
                viewers: "people viewing now",
                bkTitle: "Booking Request",
                lblName: "Full Name", lblDate: "Booking Date", lblGuests: "Total Guests", lblFamilies: "No. of Families", lblType: "Group Type",
                btnSend: "Send via WhatsApp",
                stTitle: "Settings & Help",
                stAddTitle: "Own a Farm?",
                stAddDesc: "Join us and list your farm for rent",
                stAddBtn: "Contact Admin",
                ftDesc: "Best choice for a perfect holiday", ftHome: "Home", ftFav: "Favorites", ftTerms: "Policy",
                types: { family: "Family", youth: "Youth", mixed: "Mixed" }
            }
        };

        // --- Data ---
        const farmsData = [
            { 
                id: 1, 
                name: { ar: "Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ù‡Ø¯ÙˆØ¡", ku: "Ù…Û•Ø²Ø±Û•Ø¹Ø§ Ø¦Ø§Ø±Ø§Ù…ÛŒ", en: "Serenity Farm" }, 
                location: { ar: "Ø£Ø´ÙˆØ§ - Ø³Ø±Ø³Ù†Ùƒ", ku: "Ø¦Ø§Ø´ÙˆØ§ - Ø³Û•Ø±Ø³Ù†Ú¯", en: "Ashawa - Sarsang" },
                isVerified: true, 
                images: ["dream.jpg", "https://images.unsplash.com/photo-1518780664697-55e3ad937233?w=600&q=80"], 
                features: { 
                    ar: ["Ù…Ø³Ø¨Ø­ Ù…Ø¯ÙØ£", "Ø³ÙŠÙ†Ù…Ø§ Ø®Ø§Ø±Ø¬ÙŠØ©", "Ù…ÙˆÙ„Ø¯Ø© 24h"],
                    ku: ["Ù…Û•Ø³Ø¨Û•Ø­Ø§ Ú¯Û•Ø±Ù…", "Ø³ÛŒÙ†Û•Ù…Ø§ Ø¯Û•Ø±Ú¤Û•", "Ú©Ø§Ø±Û•Ø¨Ø§ Ù¢Ù¤ Ø³Û•Ø¹Û•Øª"],
                    en: ["Heated Pool", "Outdoor Cinema", "24h Power"]
                },
                bookedDates: ["2025-12-25"], allowedType: "family", 
                pricing: { default: "150,000", special: { 4: "200,000", 5: "250,000" } } 
            },
            { 
                id: 2, 
                name: { ar: "ÙÙŠÙ„Ø§ Ø§Ù„Ø¬Ø¨Ù„", ku: "Ú¤ÛÙ„Ø§ Ú†ÛŒØ§ÛŒ", en: "Mountain Villa" }, 
                location: { ar: "Ø¬Ø¨Ù„ Ø§Ø²Ù…Ø±", ku: "Ú†ÛŒØ§ÛŒÛ Ø¦Û•Ø²Ù…Û•Ú•", en: "Azmar Mountain" },
                isVerified: false, 
                images: ["https://images.unsplash.com/photo-1518780664697-55e3ad937233?w=600&q=80"], 
                features: {
                    ar: ["Ø¥Ø·Ù„Ø§Ù„Ø© Ø¨Ø§Ù†ÙˆØ±Ø§Ù…Ø§", "Ø³Ø§Ø­Ø© Ø´ÙˆØ§Ø¡", "Ù…ÙˆÙ‚Ø¯ Ø­Ø·Ø¨"],
                    ku: ["Ø¯ÛŒÙ…Û•Ù†Û Ù¾Ø§Ù†Û†Ø±Ø§Ù…Ø§", "Ø¬Ù‡Û Ø¨Ø§Ø±Ø¨ÛŒÚ©ÛŒÛ†", "ØªÛ•Ø¨Ø§Ø®Û Ø¯Ø§Ø±Ø§"],
                    en: ["Panoramic View", "BBQ Area", "Fireplace"]
                },
                bookedDates: [], allowedType: "all", 
                pricing: { default: "75,000", special: { 4: "100,000" } } 
            },
            { 
                id: 3, 
                name: { ar: "ÙƒÙˆØ® Ø§Ù„ØºØ§Ø¨Ø©", ku: "Ú©Û†Ø®Û Ø¯Ø§Ø±Ø³ØªØ§Ù†Û", en: "Forest Cabin" }, 
                location: { ar: "Ø´Ø§Ø±Ø¨Ø§Ú˜ÙŠØ±", ku: "Ø´Ø§Ø±Ø¨Ø§Ú˜ÛÚ•", en: "Sharbazher" },
                isVerified: true, 
                images: ["https://images.unsplash.com/photo-1542718610-a1d656d1884c?w=600&q=80"], 
                features: {
                    ar: ["ØªØµÙ…ÙŠÙ… Ø®Ø´Ø¨ÙŠ", "Ø®ØµÙˆØµÙŠØ© ØªØ§Ù…Ø©", "Ù†Ù‡Ø± Ù‚Ø±ÙŠØ¨"],
                    ku: ["Ø¯ÛŒØ²Ø§ÛŒÙ†Û ØªÛ•Ø®ØªÛ•", "ØªÛ•ÙˆØ§Ùˆ ØªØ§ÛŒØ¨Û•Øª", "Ù†ÛØ²ÛŒÚ© Ú•ÙˆÙˆØ¨Ø§Ø±ÛŒ"],
                    en: ["Wooden Design", "Private", "Near River"]
                },
                bookedDates: [], allowedType: "youth", 
                pricing: { default: "50,000", special: { 4: "65,000" } } 
            }
        ];

        let currentLang = localStorage.getItem('dreamFarm_lang') || 'ar';
        let currentCategory = 'all';
        let currentSearch = '';
        let currentSearchDate = '';
        let favorites = JSON.parse(localStorage.getItem('dreamFarm_favs')) || [];
        let swiperInstances = [];

        // --- Init ---
        window.addEventListener('load', () => {
            setTimeout(() => { document.getElementById('loader').style.display = 'none'; document.getElementById('welcome-modal').style.opacity = '1'; document.getElementById('welcome-modal').style.pointerEvents = 'all'; }, 1000);
            
            // Theme Init
            const storedTheme = localStorage.getItem('dreamFarm_theme') || 'light';
            if(storedTheme === 'dark') { document.documentElement.setAttribute('data-theme', 'dark'); document.getElementById('theme-icon').classList.replace('fa-moon', 'fa-sun'); }
            
            setLanguage(currentLang);
        });

        // --- Language Logic ---
        window.toggleLangMenu = () => { document.getElementById('lang-menu').classList.toggle('show'); }
        window.setLanguage = (lang) => {
            currentLang = lang;
            localStorage.setItem('dreamFarm_lang', lang);
            document.documentElement.lang = lang;
            document.documentElement.dir = (lang === 'en') ? 'ltr' : 'rtl';
            
            // Update Static Text
            const t = translations[lang];
            const ids = {
                'main-title': t.mainTitle, 'main-subtitle': t.mainSubtitle, 'searchInput': t.searchPlace,
                'searchDate': t.datePlace, 'btn-all': t.btnAll, 'btn-fav': t.btnFav, 'btn-fam': t.btnFam,
                'btn-pool': t.btnPool, 'btn-youth': t.btnYouth, 'wm-title': t.wmTitle, 'wm-subtitle': t.wmSubtitle,
                'wm-note1': t.wmNote1, 'wm-note2': t.wmNote2, 'wm-btn': t.wmBtn, 'bk-title': t.bkTitle,
                'lbl-name': t.lblName, 'lbl-date': t.lblDate, 'lbl-guests': t.lblGuests, 'lbl-families': t.lblFamilies,
                'lbl-type': t.lblType, 'btn-send': t.btnSend, 'st-title': t.stTitle, 'st-add-title': t.stAddTitle,
                'st-add-desc': t.stAddDesc, 'st-add-btn': t.stAddBtn, 'ft-desc': t.ftDesc, 'ft-home': t.ftHome,
                'ft-fav': t.ftFav, 'ft-terms': t.ftTerms
            };
            
            for(const [id, text] of Object.entries(ids)) {
                const el = document.getElementById(id);
                if(el) {
                    if(id === 'searchInput' || id === 'searchDate') el.placeholder = text;
                    else el.innerHTML = text;
                }
            }
            
            // Re-init Datepicker
            const dateLocale = (lang === 'en') ? 'default' : 'ar';
            flatpickr("#searchDate", { locale: dateLocale, minDate: "today", dateFormat: "Y-m-d", onChange: function(s, d) { currentSearchDate = d; document.getElementById('clearDateBtn').style.display = 'block'; applyFilters(); }});

            document.getElementById('lang-menu').classList.remove('show');
            applyFilters(); // Re-render cards
        }

        // --- Viewers Logic ---
        function getSmartViewers(id) {
            const now = Date.now(); const storageKey = `viewers_smart_${id}`;
            const stored = JSON.parse(localStorage.getItem(storageKey));
            if (stored && now < stored.expiry) return stored.count;
            let newCount = Math.floor(Math.random() * 20) + 1;
            const duration = (Math.floor(Math.random() * 30) + 15) * 1000; 
            localStorage.setItem(storageKey, JSON.stringify({ count: newCount, expiry: now + duration }));
            return newCount;
        }

        function getFeatureStyle(text) {
            let icon = 'fa-check'; let color = '#555';
            const t = text.toLowerCase();
            if(t.includes('Ù…Ø³Ø¨Ø­') || t.includes('pool')) { icon = 'fa-swimming-pool'; color = '#0288d1'; }
            else if(t.includes('Ø³ÙŠÙ†Ù…Ø§') || t.includes('cinema') || t.includes('tv')) { icon = 'fa-film'; color = '#e53935'; }
            else if(t.includes('Ù…ÙˆÙ„Ø¯Ø©') || t.includes('power') || t.includes('Ú©Ø§Ø±Û•Ø¨Ø§')) { icon = 'fa-bolt'; color = '#fbc02d'; }
            else if(t.includes('Ø´ÙˆØ§Ø¡') || t.includes('bbq') || t.includes('Ø¨Ø§Ø±Ø¨ÛŒÚ©ÛŒÛ†')) { icon = 'fa-fire'; color = '#d84315'; }
            else if(t.includes('wood') || t.includes('ØªÛ•Ø®ØªÛ•') || t.includes('Ø®Ø´Ø¨ÙŠ')) { icon = 'fa-tree'; color = '#2e7d32'; }
            else if(t.includes('mountain') || t.includes('Ø¬Ø¨Ù„') || t.includes('Ú†ÛŒØ§')) { icon = 'fa-mountain'; color = '#5d4037'; }
            return { icon, color };
        }

        function renderFarms(list) {
            const container = document.getElementById('farm-list-container');
            if(swiperInstances.length > 0) { swiperInstances.forEach(s => s.destroy(true, true)); swiperInstances = []; }
            container.innerHTML = "";
            
            const t = translations[currentLang];

            if (list.length === 0) { container.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:50px;"><h3>â˜¹ï¸</h3></div>`; return; }

            list.forEach((farm) => {
                let badgeClass = farm.allowedType === 'family' ? '#E91E63' : (farm.allowedType === 'youth' ? '#9C27B0' : '#009688');
                let badgeText = t.types[farm.allowedType] || t.types.mixed;
                if(farm.allowedType === 'all') badgeText = t.types.mixed;
                
                let badge = `<span style="background:${badgeClass};color:white;padding:4px 12px;border-radius:20px;font-size:0.75rem;font-weight:bold; margin-${currentLang==='en'?'right':'left'}:auto;">${badgeText}</span>`;
                const verifiedIcon = farm.isVerified ? '<i class="fas fa-check-circle verified-badge"></i>' : '';
                const isFav = favorites.includes(farm.id) ? 'is-fav' : '';
                const heartIcon = favorites.includes(farm.id) ? 'fas fa-heart' : 'far fa-heart';
                const viewers = getSmartViewers(farm.id); 

                const slides = farm.images.map((img, index) => 
                    `<div class="swiper-slide"><img src="${img}" loading="lazy"><div class="expand-btn" onclick="openLightbox(${farm.id}, ${index})"><i class="fas fa-expand-alt"></i></div></div>`
                ).join('');

                const amenitiesHTML = farm.features[currentLang].map(f => {
                    const style = getFeatureStyle(f);
                    return `<div class="amenity-chip"><i class="fas ${style.icon} amenity-icon" style="color:${style.color}"></i> ${f}</div>`;
                }).join('');

                container.innerHTML += `
                <div class="farm-card is-visible">
                    <div class="img-actions">
                        <div class="action-icon ${isFav}" onclick="toggleFav(${farm.id}, this)"><i class="${heartIcon}"></i></div>
                    </div>
                    <div class="swiper mySwiper-${farm.id}"><div class="swiper-wrapper">${slides}</div><div class="swiper-pagination"></div></div>
                    <div class="card-content">
                        <div class="card-title-row"><h3>${farm.name[currentLang]} ${verifiedIcon}</h3>${badge}</div>
                        <div class="urgency-badge"><i class="fas fa-eye"></i> ${viewers} ${t.viewers}</div>
                        <div class="location-text"><i class="fas fa-map-marker-alt" style="color:var(--primary-gold)"></i> ${farm.location[currentLang]}</div>
                        <div class="amenities-list">${amenitiesHTML}</div>
                        <div class="price-wrapper">
                            <div><div class="price-val">${farm.pricing.default} <small style="font-size:0.8rem;font-weight:400">${t.curr}</small></div></div>
                            <button class="book-btn" onclick="openModal(${farm.id})">${t.bookBtn}</button>
                        </div>
                    </div>
                </div>`;
            });

            list.forEach(farm => {
                const sw = new Swiper(`.mySwiper-${farm.id}`, { pagination: { el: ".swiper-pagination", dynamicBullets: true }, loop: true });
                swiperInstances.push(sw);
            });
        }

        // --- Filtering ---
        window.filterFarms = (category, btnElement) => {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            if(btnElement) btnElement.classList.add('active');
            currentCategory = category;
            applyFilters();
        };

        window.clearSearchDate = (e) => { e.stopPropagation(); currentSearchDate = ''; document.getElementById('searchDate').value = ''; document.getElementById('clearDateBtn').style.display = 'none'; applyFilters(); }
        
        document.getElementById('searchInput').addEventListener('keyup', (e) => { currentSearch = e.target.value.toLowerCase(); applyFilters(); });

        function applyFilters() {
            const filtered = farmsData.filter(farm => {
                const fName = farm.name[currentLang].toLowerCase();
                const fLoc = farm.location[currentLang].toLowerCase();
                const matchesSearch = fName.includes(currentSearch) || fLoc.includes(currentSearch);
                let matchesCategory = true;
                if (currentCategory === 'favorites') matchesCategory = favorites.includes(farm.id);
                else if (currentCategory === 'family') matchesCategory = (farm.allowedType === 'family' || farm.allowedType === 'all');
                else if (currentCategory === 'youth') matchesCategory = (farm.allowedType === 'youth' || farm.allowedType === 'all');
                else if (currentCategory === 'pool') matchesCategory = farm.features['en'].some(f => f.toLowerCase().includes('pool')); // logic based on EN data for consistency
                
                let matchesDate = true;
                if(currentSearchDate) matchesDate = !farm.bookedDates.includes(currentSearchDate);
                
                return matchesSearch && matchesCategory && matchesDate;
            });
            renderFarms(filtered);
        }

        // --- Actions ---
        window.toggleFav = (id, btn) => {
            if(favorites.includes(id)) { favorites = favorites.filter(fid => fid !== id); btn.classList.remove('is-fav'); btn.innerHTML = '<i class="far fa-heart"></i>'; } 
            else { favorites.push(id); btn.classList.add('is-fav'); btn.innerHTML = '<i class="fas fa-heart"></i>'; }
            localStorage.setItem('dreamFarm_favs', JSON.stringify(favorites));
            if(currentCategory === 'favorites') applyFilters();
        }

        window.toggleTheme = () => {
            const html = document.documentElement; const icon = document.getElementById('theme-icon');
            if (html.getAttribute('data-theme') === 'dark') { html.removeAttribute('data-theme'); localStorage.setItem('dreamFarm_theme', 'light'); icon.classList.replace('fa-sun', 'fa-moon'); } 
            else { html.setAttribute('data-theme', 'dark'); localStorage.setItem('dreamFarm_theme', 'dark'); icon.classList.replace('fa-moon', 'fa-sun'); }
        }

        // --- Booking Modal ---
        const modal = document.getElementById('booking-modal');
        let currentFarmId = null;
        window.openModal = (id) => {
            currentFarmId = id;
            const farm = farmsData.find(f => f.id === id);
            document.getElementById('modal-farm-name').textContent = farm.name[currentLang];
            document.getElementById('farm-id-modal').value = id;
            
            // Populate select based on language
            const typeSel = document.getElementById('type'); typeSel.innerHTML = '';
            const t = translations[currentLang];
            if(farm.allowedType === 'family') typeSel.innerHTML = `<option>${t.types.family}</option>`;
            else if(farm.allowedType === 'youth') typeSel.innerHTML = `<option>${t.types.youth}</option>`;
            else typeSel.innerHTML = `<option>${t.types.family}</option><option>${t.types.youth}</option>`;
            
            // Re-init datepicker for modal with specific booked dates
            const dateLocale = (currentLang === 'en') ? 'default' : 'ar';
            flatpickr("#date", { locale: dateLocale, minDate: "today", dateFormat: "Y-m-d", disable: farm.bookedDates, onChange: checkPrice });
            
            document.getElementById('price-calc-area').style.display = 'none';
            document.getElementById('submit-btn').disabled = true; document.getElementById('submit-btn').style.opacity = '0.6';
            modal.classList.add('modal-active');
        }
        window.closeModal = () => { modal.classList.remove('modal-active'); }
        
        function checkPrice(selectedDates, dateStr) {
            const farm = farmsData.find(f => f.id == currentFarmId);
            if(!farm || !dateStr) return;
            const day = new Date(dateStr).getDay();
            let price = farm.pricing.default;
            if(farm.pricing.special && farm.pricing.special[day]) price = farm.pricing.special[day];
            
            const area = document.getElementById('price-calc-area');
            area.style.display = 'block';
            area.innerHTML = `<div style="font-size:0.9rem;color:var(--text-sec);">${(currentLang=='en'?'Expected Price':'Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹')}</div><div style="color:var(--primary-gold);font-weight:800;font-size:1.4rem;">${price} <small>${translations[currentLang].curr}</small></div>`;
            document.getElementById('submit-btn').disabled = false; document.getElementById('submit-btn').style.opacity = '1';
        }

        document.getElementById('booking-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const farm = farmsData.find(f => f.id == currentFarmId);
            const n = document.getElementById('name').value;
            const d = document.getElementById('date').value;
            const g = document.getElementById('guests').value;
            const t = document.getElementById('type').value;
            
            const msg = `*ğŸ”” New Booking (${farm.name[currentLang]})*\nğŸ“… ${d}\nğŸ‘¤ ${n}\nğŸ‘¥ ${g}\nğŸ“‹ ${t}`;
            window.open(`https://wa.me/9647502679528?text=${encodeURIComponent(msg)}`, '_blank');
            closeModal();
        });

        // --- Other UI ---
        window.acceptTerms = () => { document.getElementById('welcome-modal').style.opacity = '0'; document.getElementById('welcome-modal').style.pointerEvents = 'none'; }
        window.openSettingsModal = () => { document.getElementById('settings-modal').classList.add('modal-active'); }
        window.closeSettingsModal = () => { document.getElementById('settings-modal').classList.remove('modal-active'); }
        window.scrollToTop = () => { window.scrollTo({top: 0, behavior: 'smooth'}); };
        window.onscroll = () => { document.getElementById("scrollTopBtn").style.display = (window.scrollY > 300) ? "flex" : "none"; };
        
        // --- Lightbox ---
        let currentLbImages = [], currentLbIndex = 0;
        window.openLightbox = (farmId, index) => {
            const farm = farmsData.find(f => f.id === farmId); if(!farm) return;
            currentLbImages = farm.images; currentLbIndex = index; updateLb();
            document.getElementById('lightbox').classList.add('lightbox-active');
        }
        window.closeLightbox = () => { document.getElementById('lightbox').classList.remove('lightbox-active'); }
        window.changeImage = (dir) => { currentLbIndex = (currentLbIndex + dir + currentLbImages.length) % currentLbImages.length; updateLb(); }
        function updateLb() { document.getElementById('lb-image').src = currentLbImages[currentLbIndex]; document.getElementById('lb-counter').innerText = `${currentLbIndex + 1} / ${currentLbImages.length}`; }
    </script>
</body>
</html>
